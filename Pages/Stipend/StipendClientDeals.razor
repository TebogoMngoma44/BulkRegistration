@layout BlankLayout
@page "/pages/Stipend/StipendClientDeals"
@using MudBlazor

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="deals-containers" Style="font-family:'Roboto'">
    <!-- Header -->
    <MudPaper Class="pa-4 mb-4" Elevation="0" Style="background:none">
        <div class="d-flex justify-space-between align-center" style="border:none !important;border-style:none">
            <MudText Typo="Typo.h4" Style="font-weight:bold">Client Deals</MudText>
            <MudButton Variant="Variant.Outlined"
            Style="border-radius:50px"
                       StartIcon="@Icons.Material.Filled.KeyboardBackspace"
                       OnClick="GoBack">
                Back
            </MudButton>
        </div>
    </MudPaper>

    <!-- Client Card -->
    <MudPaper Class="pa-4" id="ClientCard" Elevation="2">
        <!-- Client Header -->
        <div class="d-flex justify-space-between align-center mb-4 pa-4"
             style="background-color: var(--mud-palette-background-grey);">
            <MudText Typo="Typo.h4"  style="font-weight:bold" Class="font-weight-medium">ABC Training</MudText>
            <MudButton
                        style="background:#12265e;color:white;padding:0.5rem 2rem;border-radius:50px"
                       OnClick="EditClient">
                Edit
            </MudButton>
        </div>

        <!-- Client Details -->
        <div class="pa-4">
            <MudGrid Spacing="3" Style="background-color:#f0f3f7;padding:1rem">
                <MudItem xs="12" sm="6" md="3">
                    <MudText Typo="Typo.caption" Class="text-uppercase font-weight-medium mb-2">
                        Sales Person
                    </MudText>
                    <MudText Typo="Typo.body2">xxx xxx xxx</MudText>
                </MudItem>

                <MudItem xs="12" sm="6" md="3">
                    <MudText Typo="Typo.caption" Class="text-uppercase font-weight-medium mb-2">
                        Description
                    </MudText>
                    <MudText Typo="Typo.body2">100 Characters Max</MudText>
                </MudItem>

                <MudItem xs="12" sm="6" md="3">
                    <MudText Typo="Typo.caption" Class="text-uppercase font-weight-medium mb-2">
                        Qualification
                    </MudText>
                    <MudText Typo="Typo.body2">End User Computing, RDF 5</MudText>
                </MudItem>

                <MudItem xs="12" sm="6" md="3">
                    <MudText Typo="Typo.caption" Class="text-uppercase font-weight-medium mb-2">
                        Status
                    </MudText>
                    <MudText Typo="Typo.body2" Color="Color.Success">Active</MudText>
                </MudItem>
            </MudGrid>

            <MudDivider Class="my-4" />

            <MudText Typo="Typo.subtitle1" Style="font-weight:bold">
                Client Overview - 2025
            </MudText>
        </div>
    </MudPaper>
    <!-- Top Metrics Cards -->
    <MudGrid Class="d-flex justify-center flex-grow-1 gap-4" Elevation="0">
        <MudItem xs="12" sm="6" md="3">
            <MudCard Class="metric-card">
                <MudText Typo="Typo.h3" Class="metric-number" Style="font-weight:bold">5</MudText>
                <MudText Typo="Typo.subtitle1" Class="metric-label">Total Deals</MudText>
                <MudText Typo="Typo.caption" Color="Color.Tertiary" Class="metric-sublabel">+1 today</MudText>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudCard Class="metric-card">
                <MudText Typo="Typo.h3" Class="metric-number" Style="font-weight:bold">7</MudText>
                <MudText Typo="Typo.subtitle1" Class="metric-label">Unpaid Stipends</MudText>
                <MudText Typo="Typo.caption" Color="Color.Tertiary" Class="metric-sublabel">6 days overdue</MudText>
            </MudCard>
        </MudItem>
        <MudItem xs="12" sm="6" md="3">
            <MudCard Class="metric-card">
                <MudText Typo="Typo.h3" Class="metric-number" Style="font-weight:bold">01/10/2025</MudText>
                <MudText Typo="Typo.subtitle1" Class="metric-label">Next Stipend Date</MudText>
                <MudText Typo="Typo.caption" Color="Color.Tertiary" Class="metric-sublabel">6 Days Overdue</MudText>
            </MudCard>
        </MudItem>
    </MudGrid>

    <!-- Select Dropdowns -->
    <MudGrid Class="stipend-filters-section" Style="margin-top:2rem;margin-bottom:2rem">
        <MudItem xs="12" md="6">
            <MudSelect T="string"
                       Label="Select Client"
                       @bind-Value="selectedClient"
                       Variant="Variant.Outlined"
                       Class="filter-select">
                <MudSelectItem Value="@("ABC Training")">ABC Training</MudSelectItem>
                <MudSelectItem Value="@("XYZ Company")">XYZ Company</MudSelectItem>
                <MudSelectItem Value="@("DEF Corporation")">DEF Corporation</MudSelectItem>
            </MudSelect>
        </MudItem>
        <MudItem xs="12" md="6">
            <MudSelect T="string"
                       Label="Select Deal"
                       @bind-Value="selectedDeal"
                       Variant="Variant.Outlined"
                       Placeholder="Select a Deal"
                       Class="filter-select">
                <MudSelectItem Value="@("Deal 1")">Deal 1</MudSelectItem>
                <MudSelectItem Value="@("Deal 2")">Deal 2</MudSelectItem>
                <MudSelectItem Value="@("Deal 3")">Deal 3</MudSelectItem>
            </MudSelect>
        </MudItem>
    </MudGrid>

    <!-- Data Table -->
    <MudCard Class="table-container">
        <MudTable Items="deals"
                  Dense="true"
                  Hover="true"
                  Breakpoint="Breakpoint.None"
                  Loading="false"
                  LoadingProgressColor="Color.Info"
                  Class="deals-table">
            <HeaderContent>
                <MudTh Class="table-header">DEALS</MudTh>
                <MudTh Class="table-header">SETA #</MudTh>
                <MudTh Class="table-header">LEARNERS</MudTh>
                <MudTh Class="table-header">RELEASE DATE</MudTh>
                <MudTh Class="table-header">DEAL STIPEND</MudTh>
                <MudTh Class="table-header">STATUS</MudTh>
                <MudTh Class="table-header">FEEDBACK</MudTh>
                <MudTh Class="table-header">ACTIONS</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Deals">@context.DealName</MudTd>
                <MudTd DataLabel="SETA #">@context.SetaNumber</MudTd>
                <MudTd DataLabel="Learners">@context.Learners</MudTd>
                <MudTd DataLabel="Release Date">@context.ReleaseDate</MudTd>
                <MudTd DataLabel="Deal Stipend">@context.DealStipend</MudTd>
                <MudTd DataLabel="Status">
                    <MudChip T="string" Color="@GetProgressStatusColor(context.ProgressStatus)" Size="Size.Small">
                        @context.ProgressStatus
                    </MudChip>
                </MudTd>
                <MudTd DataLabel="Feedback">@context.Feedback</MudTd>
                <MudTd Style="padding:2rem;" DataLabel="Actions">
                    <MudMenu AnchorOrigin="Origin.BottomLeft"
                             TransformOrigin="Origin.TopLeft">
                        <ActivatorContent>
                            <MudIconButton Size="Size.Small">
                                <img src="icons/more.png" alt="More actions" style="width: 20px; height: 20px;" />
                            </MudIconButton>
                        </ActivatorContent>
                        <ChildContent >
                            <MudMenuItem OnClick="@(() => StipendDeal(context))">
                                <div class="shrink" style="display: flex; align-items: center;">
                                    <img src="icons/view_icon.png" alt="More actions" style="width: 20px; height: 20px;margin-right:1.2rem" />
                                    Release Stipend
                                </div>
                            </MudMenuItem>
                            <MudMenuItem OnClick="@(() => ViewDeal(context))">
                                <div class="shink" style="display: flex; align-items: center;">
                                    <img src="icons/view_icon.png" alt="More actions" style="width: 20px; height: 20px;margin-right:1.2rem" />
                                    View
                                </div>
                            </MudMenuItem>
                            <MudMenuItem OnClick="@(() => EditDeal(context))">
                                <div class="shrink" style="display: flex; align-items: center;">
                                    <img src="icons/edit_icon.png" alt="More actions" style="width: 20px; height: 20px;margin-right:1rem" />
                                    Edit
                                </div>
                            </MudMenuItem>
                            <MudMenuItem OnClick="@(() => DownloadReport(context))">
                                <div class="shrink" style="display: flex; align-items: center;">
                                    <img src="icons/Frame 1261155191.png" alt="More actions" style="width: 20px; height: 20px; margin-right:1rem" />
                                    Download Report
                                </div>
                            </MudMenuItem>
                            <MudMenuItem OnClick="@(() => OpenSharePoint(context))">
                                <div class="shrink "style="display: flex; align-items: center;">
                                    <img src="icons/Icons/appoint.png" alt="More actions" style="width: 20px; height: 20px;margin-right:1rem" />
                                    SharePoint
                                </div>
                            </MudMenuItem>
                            <MudMenuItem OnClick="@(() => SendMessage(context))">
                                <div class="shrink" sstyle="display: flex; align-items: center;">
                                    <img src="icons/Icons/message.png" alt="More actions" style="width: 20px; height: 20px;margin-right:1rem" />
                                    Message
                                </div>
                            </MudMenuItem>

                        </ChildContent>
                    </MudMenu>
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudCard>

    <!-- Snackbar for notifications -->
    <MudSnackbarProvider />
</MudContainer>

@code {


    private string selectedClient = "ABC Training";
    private string selectedDeal = "";

    [Inject] ISnackbar SnackbarService { get; set; }

    private List<DealRecord> deals = new List<DealRecord>
    {
        new DealRecord
        {
            DealName = "Deal Name",
            SetaNumber = "xxx xxx xxx",
            Learners = 7,
            ReleaseDate = "7/7",
            Status = "COMPETENT",
            DealStipend = 0,
            ProgressStatus = "IN PROGRESS",
            Feedback = "Deal is on track"
        },
        new DealRecord
        {
            DealName = "Deal Name",
            SetaNumber = "xxx xxx xxx",
            Learners = 16,
            ReleaseDate = "8/16",
            Status = "COMPETENT",
            DealStipend = 4,
            ProgressStatus = "REGISTRATION",
            Feedback = "Awaiting documents"
        },
        new DealRecord
        {
            DealName = "Deal Name",
            SetaNumber = "xxx xxx xxx",
            Learners = 18,
            ReleaseDate = "17/18",
            Status = "AT RISK",
            DealStipend = 8,
            ProgressStatus = "SETA MODERATION",
            Feedback = "Learners are not completing their work"
        },
        new DealRecord
        {
            DealName = "Deal Name",
            SetaNumber = "xxx xxx xxx",
            Learners = 9,
            ReleaseDate = "3/9",
            Status = "COMPETENT",
            DealStipend = 2,
            ProgressStatus = "INDUCTION",
            Feedback = "Deal is on track"
        }
    };

    private Color GetStatusColor(string status)
    {
        return status switch
        {
            "COMPETENT" => Color.Success,
            "AT RISK" => Color.Error,
            "INCOMPLETE" => Color.Warning,
            _ => Color.Default
        };
    }

    private Color GetProgressStatusColor(string status)
    {
        return status switch
        {
            "IN PROGRESS" => Color.Info,
            "REGISTRATION" => Color.Warning,
            "SETA MODERATION" => Color.Secondary,
            "INDUCTION" => Color.Primary,
            "COMPLETED" => Color.Success,
            _ => Color.Default
        };
    }

    // Action methods for menu items
    private void StipendDeal(DealRecord deal)
    {
        SnackbarService.Add($"Stipend deal: {deal.DealName}", Severity.Info);
        // Add your view logic here
    }

    private void ViewDeal(DealRecord deal)
    {
        SnackbarService.Add($"Viewing deal: {deal.DealName}", Severity.Info);
        // Add your view logic here
    }

    private void EditDeal(DealRecord deal)
    {
        SnackbarService.Add($"Editing deal: {deal.DealName}", Severity.Info);
        // Add your edit logic here
    }

    private void DownloadReport(DealRecord deal)
    {
        SnackbarService.Add($"Downloading report for: {deal.DealName}", Severity.Success);
        // Add your download logic here
    }

    private void OpenSharePoint(DealRecord deal)
    {
        SnackbarService.Add($"Opening SharePoint for: {deal.DealName}", Severity.Info);
        // Add your SharePoint logic here
    }

    private void SendMessage(DealRecord deal)
    {
        SnackbarService.Add($"Sending message for: {deal.DealName}", Severity.Info);
        // Add your messaging logic here
    }

    private void GoBack()
    {
        // Navigate back to previous page
        // NavigationManager.NavigateTo("/previous-page");
    }

    private void EditClient()
    {
        // Navigate to edit page or open dialog
        // NavigationManager.NavigateTo("/client-deals/edit/abc-training");
    }

    public class DealRecord
    {
        public string DealName { get; set; } = "";
        public string SetaNumber { get; set; } = "";
        public int Learners { get; set; }
        public string ReleaseDate { get; set; } = "";
        public string Status { get; set; } = "";
        public int DealStipend { get; set; }
        public string ProgressStatus { get; set; } = "";
        public string Feedback { get; set; } = "";
    }
}